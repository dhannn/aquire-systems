<script>
    document.addEventListener('DOMContentLoaded', function() {
        var timeout = null;
        document.getElementById('studentId').addEventListener('keyup', function () {
            clearTimeout(timeout);
            timeout = setTimeout(function() {
                var textvalue = document.getElementById('studentId').value;
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/guidance', true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.onload = function() {
                    if(xhr.status === 200) {
                        if (xhr.status === 200) {
                            var response = JSON.parse(xhr.responseText);
                            var recordIds = response.recordIds;

                            // Update checkboxes
                            var checkboxes = document.querySelectorAll('[name="recordTypes[]"]');
                            checkboxes.forEach(function(checkbox) {
                                if (recordIds.includes(checkbox.value)) {
                                    checkbox.checked = true;
                                    checkbox.classList.add('greyed-out');
                                } else {
                                    checkbox.checked = false;
                                    checkbox.classList.remove('greyed-out');
                                }
                            });
                        }
                    }
                };
                xhr.onerror = function() {
                    console.error('Request Error...');
                };
                xhr.send(JSON.stringify({textData: textvalue}));
            }, 500);
        });
        document.getElementById('studentId-cummilative-anecdotal').addEventListener('keyup', function () {
            clearTimeout(timeout);
            timeout = setTimeout(function() {
                var baseStudentId = document.getElementById('studentId-cummilative-anecdotal').value;
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/guidance/cummulative-get', true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        var schoolActivity = response.schoolActivity;
                        document.querySelector('[name="juniorkinder_school_year"]').value = schoolActivity[12].schoolYear;
                        document.querySelector('[name="juniorkinder_club_name"]').value = schoolActivity[12].clubName;
                        document.querySelector('[name="juniorkinder_field_trips"]').value = schoolActivity[12].clubParticipation;
                        document.querySelector('[name="seniorkinder_school_year"]').value = schoolActivity[13].schoolYear;
                        document.querySelector('[name="seniorkinder_club_name"]').value = schoolActivity[13].clubName;
                        document.querySelector('[name="seniorkinder_field_trips"]').value = schoolActivity[13].clubParticipation;
                        document.querySelector('[name="grade1_school_year"]').value = schoolActivity[0].schoolYear;
                        document.querySelector('[name="grade1_club_name"]').value = schoolActivity[0].clubName;
                        document.querySelector('[name="grade1_field_trips"]').value = schoolActivity[0].clubParticipation;
                        document.querySelector('[name="grade2_school_year"]').value = schoolActivity[4].schoolYear;
                        document.querySelector('[name="grade2_club_name"]').value = schoolActivity[4].clubName;
                        document.querySelector('[name="grade2_field_trips"]').value = schoolActivity[4].clubParticipation;
                        document.querySelector('[name="grade3_school_year"]').value = schoolActivity[5].schoolYear;
                        document.querySelector('[name="grade3_club_name"]').value = schoolActivity[5].clubName;
                        document.querySelector('[name="grade3_field_trips"]').value = schoolActivity[5].clubParticipation;
                        document.querySelector('[name="grade4_school_year"]').value = schoolActivity[6].schoolYear;
                        document.querySelector('[name="grade4_club_name"]').value = schoolActivity[6].clubName;
                        document.querySelector('[name="grade4_field_trips"]').value = schoolActivity[6].clubParticipation;
                        document.querySelector('[name="grade5_school_year"]').value = schoolActivity[7].schoolYear;
                        document.querySelector('[name="grade5_club_name"]').value = schoolActivity[7].clubName;
                        document.querySelector('[name="grade5_field_trips"]').value = schoolActivity[7].clubParticipation;
                        document.querySelector('[name="grade6_school_year"]').value = schoolActivity[8].schoolYear;
                        document.querySelector('[name="grade6_club_name"]').value = schoolActivity[8].clubName;
                        document.querySelector('[name="grade6_field_trips"]').value = schoolActivity[8].clubParticipation;
                        document.querySelector('[name="grade7_school_year"]').value = schoolActivity[9].schoolYear;
                        document.querySelector('[name="grade7_club_name"]').value = schoolActivity[9].clubName;
                        document.querySelector('[name="grade7_field_trips"]').value = schoolActivity[9].clubParticipation;
                        document.querySelector('[name="grade8_school_year"]').value = schoolActivity[10].schoolYear;
                        document.querySelector('[name="grade8_club_name"]').value = schoolActivity[10].clubName;
                        document.querySelector('[name="grade8_field_trips"]').value = schoolActivity[10].clubParticipation;
                        document.querySelector('[name="grade9_school_year"]').value = schoolActivity[11].schoolYear;
                        document.querySelector('[name="grade9_club_name"]').value = schoolActivity[11].clubName;
                        document.querySelector('[name="grade9_field_trips"]').value = schoolActivity[11].clubParticipation;
                        document.querySelector('[name="grade10_school_year"]').value = schoolActivity[1].schoolYear;
                        document.querySelector('[name="grade10_club_name"]').value = schoolActivity[1].clubName;
                        document.querySelector('[name="grade10_field_trips"]').value = schoolActivity[1].clubParticipation;
                        document.querySelector('[name="grade11_school_year"]').value = schoolActivity[2].schoolYear;
                        document.querySelector('[name="grade11_club_name"]').value = schoolActivity[2].clubName;
                        document.querySelector('[name="grade11_field_trips"]').value = schoolActivity[2].clubParticipation;
                        document.querySelector('[name="grade12_school_year"]').value = schoolActivity[3].schoolYear;
                        document.querySelector('[name="grade12_club_name"]').value = schoolActivity[3].clubName;
                        document.querySelector('[name="grade12_field_trips"]').value = schoolActivity[3].clubParticipation;
                    } else {
                        console.error('Request failed with status:', xhr.status);
                    }
                };
                xhr.onerror = function() {
                    console.error('Request Error...');
                };
                xhr.send(JSON.stringify({textData: baseStudentId}));
            }, 500);
        });
    });

     document.getElementById('edit_cummulative_record').addEventListener('click', function () {
        event.preventDefault();
        const baseStudentId = document.getElementById('studentId-cummilative-anecdotal').value;
        document.getElementById('studentIdField').value = baseStudentId;
     });
</script>