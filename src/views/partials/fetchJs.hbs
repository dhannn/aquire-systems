<script>
    document.addEventListener('DOMContentLoaded', function() {
        var timeout = null;
        document.getElementById('studentId').addEventListener('keyup', function () {
            clearTimeout(timeout);
            timeout = setTimeout(function() {
                var textvalue = document.getElementById('studentId').value;
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/guidance', true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.onload = function() {
                    if(xhr.status === 200) {
                        if (xhr.status === 200) {
                            var response = JSON.parse(xhr.responseText);
                            var recordIds = response.recordIds;

                            // Update checkboxes
                            var checkboxes = document.querySelectorAll('[name="recordTypes[]"]');
                            checkboxes.forEach(function(checkbox) {
                                if (recordIds.includes(checkbox.value)) {
                                    checkbox.checked = true;
                                    checkbox.classList.add('greyed-out');
                                } else {
                                    checkbox.checked = false;
                                    checkbox.classList.remove('greyed-out');
                                }
                            });
                        }
                    }
                };
                xhr.onerror = function() {
                    console.error('Request Error...');
                };
                xhr.send(JSON.stringify({textData: textvalue}));
            }, 500);
        });
        document.getElementById('studentId-cummilative-anecdotal').addEventListener('keyup', function () {
            clearTimeout(timeout);
            timeout = setTimeout(function() {
                var baseStudentId = document.getElementById('studentId-cummilative-anecdotal').value;
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/guidance/cummulative-get', true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.onload = function() {
                    if (xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        var schoolHistory = response.schoolHistory;
                         document.querySelector('[name="enteredFrom_gs"]').value = schoolHistory[0].enteredFrom;
                        document.querySelector('[name="schoolYearAdmitted_gs"]').value = schoolHistory[0].schoolYearAdmitted;
                        document.querySelector('[name="gradeLevelEntered_gs"]').value = schoolHistory[0].gradeLevelEntered;
                        document.querySelector('[name="otherSchoolsAttended_gs"]').value = schoolHistory[0].otherSchoolsAttended;
                        document.querySelector('[name="enteredFrom"]').value = schoolHistory[1].enteredFrom;
                        document.querySelector('[name="schoolYearAdmitted"]').value = schoolHistory[1].schoolYearAdmitted;
                        document.querySelector('[name="gradeLevelEntered"]').value = schoolHistory[1].gradeLevelEntered;
                        document.querySelector('[name="otherSchoolsAttended"]').value = schoolHistory[1].otherSchoolsAttended;
                    } else {
                        console.error('Request failed with status:', xhr.status);
                    }
                };
                xhr.onerror = function() {
                    console.error('Request Error...');
                };
                xhr.send(JSON.stringify({textData: baseStudentId}));
            }, 500);
        });
    });

     document.getElementById('edit_cummulative_record').addEventListener('click', function () {
        event.preventDefault();
        const baseStudentId = document.getElementById('studentId-cummilative-anecdotal').value;
        document.getElementById('studentIdField').value = baseStudentId;
     });
    </script>